function StreamCrop(t,e){this.cropRea=e,this.inputStream=t,this.inputVideoStream=null,this.video=null,this.canvas=null,this.ctx=null,this.timeoutId,this.outputStream=null,this.imageCapture=null}StreamCrop.prototype.absCropRea=function(t){return new Promise((e=>{this.inputStream||e(t),t.x<1&&t.y<1&&t.w<1&&t.h<1||e(t),this.imageCapture.grabFrame().then((function(a){var r=a.width,n=a.height;e({x:t.x*r,y:t.y*n,w:t.w*r,h:t.h*n})})).catch((function(){e(t)}))}))},StreamCrop.prototype.prepare=function(){var t=this;return this.canvas=document.createElement("canvas"),new Promise((function(e){t.inputStream?(t.imageCapture=new ImageCapture(t.inputStream.getVideoTracks()[0]),t.absCropRea(t.cropRea).then((function(a){t.canvas.width=a.w,t.canvas.height=a.h,t.ctx=t.canvas.getContext("2d");var r=t.canvas.captureStream(),n=t.inputStream.getAudioTracks(),i=r.getVideoTracks();t.outPutStream=new MediaStream([...i,...n]),e()}))):e()}))},StreamCrop.prototype.render=function(){var t=this,e=(this.ctx,this.imageCapture);clearTimeout(this.timeoutId),t.absCropRea(t.cropRea).then((a=>{var r=-a.x,n=-a.y;const i=(a,r)=>{e.grabFrame().then((e=>{t.ctx.drawImage(e,a,r),this.timeoutId=window.setTimeout(i,34)}))};i(r,n),resolve()}))},StreamCrop.prototype.stop=function(){window.cancelAnimationFrame(this.animationFrameId),clearTimeout(this.timeoutId),this.outputStream?.getTracks().forEach((t=>t.stop())),this.outputStream=null,this.canvas=null,this.video=null,this.inputVideoStream=null,this.canvasStream=null,this.inputStream?.getTracks().forEach((t=>t.stop())),this.inputStream=null,this.ctx=null},StreamCrop.prototype.cropSteam=function(t){return new Promise((function(e){t&&(that.cropRea=t),that.prepare().then((function(){that.render().then(e())}))}))},StreamCrop.prototype.output=function(){return this.outPutStream};