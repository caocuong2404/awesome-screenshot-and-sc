var youtube_prefix="ba9b_",google_prefix="c822_",Bg=chrome.extension.getBackgroundPage();function getList(e){return new Promise((function(t,i){$.ajax({type:"GET",url:"https://preview.diigo.com/api/v3/awe/upload/?user_id="+e,dataType:"json",success:function(e){t(e)},error:function(e,t){i([e,t])}})}))}function initList(){DB.init().then(DB.getAll.bind(DB)).then((function(e){buildList(e)})),$("#delete-all").on("click",(function(e){if(e.preventDefault(),confirm("Are you sure to delete all the recordings?")){var t=[];DB.getAll().then((function(e){t=e.map((function(e){return e.fileUrl.match(/\/persistent\/(.*)$/)[1]})),t.forEach((function(e){Bg.fileSaver.remove(e)})),DB.deleteAll().then(updateList)}))}}))}function updateList(){DB.getAll().then(buildList)}function buildList(e){e=e.reverse();var t=$("#video-container");if(t.empty(),e.length){var i=$("#video-item-template").html();e.forEach((function(e){var n=e.detail,r=$(i);r.find("a").attr("href",chrome.runtime.getURL("/video-react.html?id="+e.id)),r.find(".thumbnail-img").attr("src",n.thumbnailUrl),r.find(".title").text(n.title).attr("title",n.title),r.find(".duration").text(n.duration),r.find(".size").text(n.size),r.attr("data-id",e.id),r.find(".delete-icon").on("click",(function(){if(confirm("Are you sure to delete this recording?")){if(e.fileUrl&&e.fileUrl.match(/\/persistent\/(.*)$/)[1]){var t=e.fileUrl.match(/\/persistent\/(.*)$/)[1];Bg.fileSaver.remove(t)}DB.delete(e.id).then(updateList)}})),n.youtubeUrl&&r.addClass("shared_youtube"),n.gDriveUrl&&r.addClass("shared_gDrive"),n.awsUrl&&r.addClass("shared_aws"),r.appendTo(t)}))}}initList();